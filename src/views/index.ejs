<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>WebChat</title>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Nunito:wght@200;300;400;500&display=swap"
			rel="stylesheet"
		/>
		<!-- <link rel="stylesheet" src="index.css"> -->
		<script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="main.css">
  </head>
  <body>
    <div class="chat">
      <h3 class="chat__welcome">Bem vindo!</h3>
      <ul class=chat__box></ul>
      <form class="chat__form" action="">
        <input class="chat__chat-input" type="text">
        <button class="chat__chat-button">Enviar</button>
      </form>
    </div>
    <script>
      const socket = io();
      const chat = document.querySelector('.chat');
      const welcome = document.querySelector('.chat__welcome');
      const chatBox = document.querySelector('.chat__box');
      const chatForm = document.querySelector('.chat__form');
      const chatInput = document.querySelector('.chat__chat-input');
      const chatButton = document.querySelector('.chat__chat-button');
      
      const randomUserName = () => {
        const upper = [...Array(26).keys()]
          .map((_, i) => String.fromCharCode(i + 65)).join('');
        const alpha = upper.concat(upper.toLowerCase(), '0123456789');
        let nickname = ''
        while (nickname.length < 16) {
          nickname += alpha[Math.floor(Math.random() * alpha.length)];
        }
        return nickname;
      };
      sessionStorage.setItem('nickname', randomUserName());
      welcome.addEventListener('click', () => {
        chatBox.classList.toggle('close');
      });
      chatForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const chatMessage = chatInput.value;
        const nickname = sessionStorage.getItem('nickname');
        socket.emit('message', { chatMessage, nickname });
        chatInput.value = '';
      });
      const insertMessage = (userMessage) => {
        const li = document.createElement('li');
        li.innerText = userMessage;
        chatBox.appendChild(li);
      };
      socket.on('message', insertMessage);
    </script>
	</body>
</html>
